<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcim - Connect Your Sources</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Manrope', sans-serif;
            background: #f2f1f0;
            color: #1a1a1a;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            min-height: 100vh;
            transition: all 0.4s ease;
        }

        /* Navigation */
        .nav-bar {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.75rem;
            font-weight: 700;
            color: #000000;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-item {
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 6px;
        }

        .nav-item:hover {
            color: #000000;
            background: rgba(0, 0, 0, 0.1);
        }

        .nav-item.active {
            color: #000000;
            background: rgba(0, 0, 0, 0.1);
        }

        /* Landing Page */
        .landing {
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.6s ease;
        }

        .hero {
            text-align: center;
            padding: 4rem 0;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.05);
            margin-bottom: 3rem;
            overflow: hidden;
            position: relative;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(74, 144, 226, 0.05) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
            pointer-events: none;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #1a1a1a;
            position: relative;
            z-index: 1;
        }

        .hero p {
            font-size: 1.25rem;
            color: #666;
            margin-bottom: 3rem;
            position: relative;
            z-index: 1;
        }

        .cta-buttons {
            display: flex;
            gap: 2rem;
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        .btn {
            padding: 1rem 2.5rem;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: #000000;
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #4A90E2;
            border: 2px solid #4A90E2;
        }

        .btn-secondary:hover {
            background: #4A90E2;
            color: white;
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, #48C774, #3ABB67);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 199, 116, 0.3);
        }

        /* Features Grid */
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .feature-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .feature-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #4A90E2, #48C774);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .feature-card:hover::after {
            transform: scaleX(1);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .feature-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1a1a1a;
        }

        .feature-desc {
            color: #666;
        }

        /* Dashboard */
        .dashboard {
            display: flex;
            min-height: calc(100vh - 80px);
            animation: slideIn 0.4s ease;
            background: #000000;
        }

        .dashboard-dark {
            background: #000000;
            color: #ffffff;
        }

        .dashboard-dark + * .nav-bar,
        .dashboard ~ .nav-bar {
            display: none;
        }

        body.dashboard-active .nav-bar {
            display: none;
        }

        .sidebar {
            width: 260px;
            background: #000000;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem 1rem;
            box-shadow: none;
        }

        .sidebar-logo {
            color: #ffffff;
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 2rem;
            padding: 0 1rem;
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav-item {
            padding: 0.75rem 1rem;
            color: #ffffff;
            cursor: pointer;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: 'Manrope', sans-serif;
        }

        .sidebar-nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .sidebar-nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-title {
            font-size: 0.875rem;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .connection-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .connection-item:hover {
            background: #f8f9fa;
        }

        .connection-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 1rem;
        }

        .status-connected {
            background: #48C774;
            box-shadow: 0 0 10px rgba(72, 199, 116, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        .status-available {
            background: #ccc;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: #000000;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: none;
            padding: 1.5rem;
            border-radius: 12px;
            color: #ffffff;
            font-family: 'Manrope', sans-serif;
        }

        .dashboard-card-label {
            color: #cccccc;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            font-family: 'Manrope', sans-serif;
        }

        .dashboard-card-value {
            font-size: 2rem;
            font-weight: normal;
            margin-bottom: 0.5rem;
            font-family: 'Manrope', sans-serif;
        }

        .dashboard-card-change {
            color: #4ade80;
            font-size: 0.875rem;
            font-weight: 500;
            font-family: 'Manrope', sans-serif;
        }

        .dashboard-large-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .dashboard-chart {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: none;
            padding: 1.5rem;
            border-radius: 12px;
            color: #ffffff;
        }

        .dashboard-table {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: none;
            padding: 1.5rem;
            border-radius: 12px;
            color: #ffffff;
        }

        .invoice-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .invoice-item:last-child {
            border-bottom: none;
        }

        .invoice-company {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .company-logo {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #6a6a6a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .invoice-amount {
            text-align: right;
        }

        .invoice-days {
            color: #cccccc;
            font-size: 0.875rem;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .welcome-text {
            font-size: 1.75rem;
            font-weight: 600;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .metric-label {
            color: #666;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            font-weight: 600;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 0.5rem;
        }

        .metric-change {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .change-positive {
            background: rgba(72, 199, 116, 0.1);
            color: #48C774;
        }

        .change-negative {
            background: rgba(255, 82, 82, 0.1);
            color: #FF5252;
        }

        /* Charts */
        .chart-container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .chart-placeholder {
            height: 300px;
            background: linear-gradient(90deg, #f0f0f0 0%, #f8f8f8 50%, #f0f0f0 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 250px;
            padding: 0 1rem;
        }

        .chart-bar {
            width: 40px;
            background: linear-gradient(180deg, #4A90E2, #357ABD);
            border-radius: 4px 4px 0 0;
            animation: growBar 1s ease-out forwards;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chart-bar:hover {
            background: linear-gradient(180deg, #5BA0F2, #4589CD);
            transform: scaleY(1.05);
        }

        @keyframes growBar {
            0% { height: 0; }
        }

        /* Insights Panel */
        .insights-panel {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
        }

        .insights-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .insight-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .insight-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .insight-icon {
            font-size: 1.25rem;
            margin-right: 1rem;
            color: #4A90E2;
        }

        /* Data Connection Hub */
        .connection-hub {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.6s ease;
        }

        /* Progress Bar */
        .progress-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 2rem 0 3rem 0;
            position: relative;
        }

        .progress-bar {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .progress-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .progress-circle.completed {
            background: #000000;
            border-color: #000000;
        }

        .progress-circle.current {
            background: #4A90E2;
            border-color: #4A90E2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.3);
        }

        .progress-circle.pending {
            background: #e9ecef;
            color: #666;
            border-color: #e9ecef;
        }

        .progress-label {
            font-size: 0.875rem;
            text-align: center;
            color: #666;
            max-width: 80px;
        }

        .progress-label.current {
            color: #000000;
            font-weight: 600;
        }

        .progress-connector {
            width: 50px;
            height: 3px;
            background: #e9ecef;
            position: relative;
            margin: 0 1rem;
        }

        .progress-connector.completed {
            background: #000000;
        }

        /* Processing Steps */
        .processing-steps {
            max-width: 400px;
            margin: 0 auto;
            text-align: left;
        }

        .processing-step {
            display: flex;
            align-items: center;
            padding: 0.75rem 0;
            color: #666666;
            transition: all 0.3s ease;
        }

        .processing-step.processing {
            color: #4A90E2;
        }

        .processing-step.completed {
            color: #4ade80;
        }

        .processing-indicator {
            width: 20px;
            height: 20px;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .processing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #666666;
            transition: all 0.3s ease;
        }

        .processing-step.processing .processing-dot {
            background: #4A90E2;
            animation: pulse 1s infinite;
        }

        .processing-step.completed .processing-dot {
            background: #4ade80;
            animation: none;
        }

        .processing-step.completed .processing-dot::after {
            content: '✓';
            color: #000000;
            font-size: 10px;
            font-weight: bold;
            position: absolute;
            margin-left: -5px;
            margin-top: -7px;
        }

        .processing-text {
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .integration-section {
            margin-bottom: 3rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #1a1a1a;
        }

        .integration-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.5rem;
        }
        
        .integration-grid .integration-card {
            min-width: 200px;
            max-width: 250px;
        }

        .integration-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .integration-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
        }

        .integration-card.connected {
            border: 2px solid #48C774;
        }

        .integration-card.connected::after {
            content: '✓';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #48C774;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .integration-logo {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .integration-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .integration-status {
            color: #666;
            font-size: 0.875rem;
        }

        /* Lender Dashboard */
        .portfolio-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4A90E2;
        }

        .stat-label {
            color: #666;
            margin-top: 0.5rem;
        }

        /* Tables */
        .data-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            font-weight: 600;
            font-size: 1.25rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
        }

        th, td {
            padding: 1rem 1.5rem;
            text-align: left;
        }

        th {
            font-weight: 600;
            color: #666;
            font-size: 0.875rem;
            text-transform: uppercase;
        }

        tbody tr {
            border-bottom: 1px solid #e9ecef;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        /* Override for FSP portal dark tables */
        .dashboard-dark table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05) !important;
        }

        .dashboard-dark table thead tr {
            background: transparent !important;
        }

        .dashboard-dark table thead th {
            background: transparent !important;
        }

        .risk-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .risk-low {
            background: rgba(72, 199, 116, 0.1);
            color: #48C774;
        }

        .risk-medium {
            background: rgba(255, 193, 7, 0.1);
            color: #FFC107;
        }

        .risk-high {
            background: rgba(255, 82, 82, 0.1);
            color: #FF5252;
        }

        /* Credit Analysis */
        .credit-analysis {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.6s ease;
        }

        .analysis-header {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }

        .risk-score-container {
            text-align: center;
            border-right: 1px solid #e9ecef;
        }

        .risk-score {
            font-size: 4rem;
            font-weight: 700;
            color: #48C774;
            margin-bottom: 0.5rem;
        }

        .risk-label {
            font-size: 1.25rem;
            color: #48C774;
            font-weight: 600;
        }

        .financial-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .summary-item {
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .summary-label {
            color: #666;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .summary-value {
            font-size: 1.25rem;
            font-weight: 600;
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4A90E2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            0% { transform: translateY(50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .modal-body {
            margin-bottom: 1.5rem;
            color: #666;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* Animations */
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        @keyframes slideIn {
            0% { transform: translateX(-20px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                order: 2;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .cta-buttons {
                flex-direction: column;
                align-items: center;
            }

            .hero h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div id="app" class="container">
        <!-- Navigation Bar -->
        <nav class="nav-bar">
            <div class="logo" onclick="navigateTo('landing')">
                <img src="arcim-logo.svg" alt="Arcim" style="height: 72px;">
            </div>
            <div class="nav-menu">
                <span class="nav-item" id="dashboardNav" style="display:none;" onclick="navigateTo('dashboard')">Dashboard</span>
                <span class="nav-item" id="dataNav" style="display:none;" onclick="navigateTo('connections')">Data</span>
                <span class="nav-item" id="analyticsNav" style="display:none;" onclick="navigateTo('analytics')">Analytics</span>
                <span class="nav-item" id="portfolioNav" style="display:none;" onclick="navigateTo('lenderDashboard')">Portfolio</span>
                <button class="btn btn-secondary" onclick="navigateTo('fspLogin')" style="margin-left: 1rem;">
                    FSP Portal
                </button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <div id="content"></div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="modalHeader"></div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer" id="modalFooter"></div>
        </div>
    </div>

    <script>
        // Application State
        let currentView = 'landing';
        let userType = null; // 'sme' or 'lender' or 'fsp'
        let connectedSources = [];
        let selectedCompany = null;
        let selectedFSPCompany = 'company-a';
        let connectionStep = 1; // Current step in connection flow (1-4)
        let completedSteps = []; // Array of completed step numbers

        // Demo Data
        const demoData = {
            reports: {
                riskGrade: 'B',
                dscrBase: '1.27×',
                dscrDownside: '1.08×',
                runway: '5.2 months',
                medianNetCF: '+150k SEK',
                medianNetCFDetails: 'CV 0.37; 3/12 months negative',
                dso: '43d',
                dpo: '47d',
                ccc: '–4d',
                arTotal: '2.05M SEK',
                arAging: '14% >60d (293k)',
                apTotal: '1.72M SEK',
                existingDebt: '50k SEK/mo',
                proposedLoan: '2.5M @ 8% for 36 mo',
                proposedPayment: '78,341 SEK/mo',
                concentration: 'Top-3 customers = 58% of receipts',
                compliance: 'Skatteverket on time; NSF days: 2 (last 12 mo)',
                cashFlowSeries: {
                    cashIn: '22.4M',
                    cashOut: '20.6M',
                    net: '+1.8M',
                    trend: 'closing balance trend included'
                }
            },
            companies: {
                'company-a': {
                    name: 'Företag AB',
                    industry: 'Retail',
                    metrics: {
                        proFormaDSCR: '1.27x',
                        proFormaDSCRChange: '+5%',
                        cashRunway: '5.2 months',
                        cashRunwayChange: '+12%',
                        medianNetCashFlow: '+150k',
                        medianNetCashFlowCV: 'CV 0.37; 3/12',
                        medianNetCashFlowChange: '+8%',
                        cashInOut: '22.4M',
                        cashInOutChange: '↑2',
                        dso: '42',
                        dsoChange: '+8%',
                        dpo: '47',
                        dpoChange: '+12%',
                        cashConversionCycle: '−4 days',
                        cashConversionChange: '+9%'
                    },
                    riskScore: 72,
                    riskLevel: 'Low',
                    loanAmount: '2M SEK',
                    unpaidInvoices: [
                        { company: 'Northbridge Components AB', amount: '412,000', days: '52 days', logo: 'NB', color: '#ff6b6b' },
                        { company: 'Keystone Analytics Konsult', amount: '265,000', days: '37 days', logo: 'KA', color: '#4ecdc4' },
                        { company: 'Fjordbyte AS', amount: '198,000', days: '74 days', logo: 'FJ', color: '#45b7d1' },
                        { company: 'Skylark Creative Studio AB', amount: '126,000', days: '18 days', logo: 'SC', color: '#96ceb4' },
                        { company: 'Cedar Peak Supply AB', amount: '91,000', days: '63 days', logo: 'CP', color: '#feca57' },
                        { company: 'Northbridge Components AB', amount: '412,000', days: '52 days', logo: 'NB', color: '#ff9ff3' }
                    ]
                },
                'company-b': {
                    name: 'TechVision AB',
                    industry: 'SaaS',
                    metrics: {
                        proFormaDSCR: '1.05x',
                        proFormaDSCRChange: '+15%',
                        cashRunway: '3.8 months',
                        cashRunwayChange: '+25%',
                        medianNetCashFlow: '+85k',
                        medianNetCashFlowCV: 'CV 0.52; 5/12',
                        medianNetCashFlowChange: '+18%',
                        cashInOut: '12.8M',
                        cashInOutChange: '↑5',
                        dso: '28',
                        dsoChange: '+15%',
                        dpo: '35',
                        dpoChange: '+8%',
                        cashConversionCycle: '−7 days',
                        cashConversionChange: '+12%'
                    },
                    riskScore: 58,
                    riskLevel: 'Medium',
                    loanAmount: '3.5M SEK',
                    unpaidInvoices: [
                        { company: 'Digital Solutions Nordic', amount: '185,000', days: '28 days', logo: 'DS', color: '#4ecdc4' },
                        { company: 'CloudTech Partners', amount: '125,000', days: '15 days', logo: 'CT', color: '#45b7d1' },
                        { company: 'StartUp Accelerator AB', amount: '98,000', days: '42 days', logo: 'SA', color: '#96ceb4' },
                        { company: 'Innovation Hub Stockholm', amount: '67,000', days: '31 days', logo: 'IH', color: '#feca57' }
                    ]
                },
                'company-c': {
                    name: 'Nordisk Industri AB',
                    industry: 'Manufacturing',
                    metrics: {
                        proFormaDSCR: '1.45x',
                        proFormaDSCRChange: '+3%',
                        cashRunway: '8.7 months',
                        cashRunwayChange: '+5%',
                        medianNetCashFlow: '+320k',
                        medianNetCashFlowCV: 'CV 0.28; 1/12',
                        medianNetCashFlowChange: '+4%',
                        cashInOut: '45.2M',
                        cashInOutChange: '↑1',
                        dso: '55',
                        dsoChange: '+2%',
                        dpo: '62',
                        dpoChange: '+4%',
                        cashConversionCycle: '−7 days',
                        cashConversionChange: '+1%'
                    },
                    riskScore: 81,
                    riskLevel: 'Low',
                    loanAmount: '8.5M SEK',
                    unpaidInvoices: [
                        { company: 'Steel Supply Scandinavia', amount: '650,000', days: '45 days', logo: 'SS', color: '#ff6b6b' },
                        { company: 'Nordic Components Ltd', amount: '485,000', days: '38 days', logo: 'NC', color: '#4ecdc4' },
                        { company: 'Industrial Equipment AB', amount: '325,000', days: '52 days', logo: 'IE', color: '#45b7d1' },
                        { company: 'Manufacturing Tools Co', amount: '198,000', days: '29 days', logo: 'MT', color: '#96ceb4' },
                        { company: 'Quality Control Systems', amount: '156,000', days: '67 days', logo: 'QC', color: '#feca57' }
                    ]
                },
                'company-d': {
                    name: 'Green Energy Solutions',
                    industry: 'Energy',
                    metrics: {
                        proFormaDSCR: '0.92x',
                        proFormaDSCRChange: '-8%',
                        cashRunway: '2.1 months',
                        cashRunwayChange: '-15%',
                        medianNetCashFlow: '-45k',
                        medianNetCashFlowCV: 'CV 0.85; 8/12',
                        medianNetCashFlowChange: '-12%',
                        cashInOut: '8.5M',
                        cashInOutChange: '↓3',
                        dso: '78',
                        dsoChange: '+22%',
                        dpo: '41',
                        dpoChange: '+5%',
                        cashConversionCycle: '37 days',
                        cashConversionChange: '+28%'
                    },
                    riskScore: 34,
                    riskLevel: 'High',
                    loanAmount: '2.8M SEK',
                    unpaidInvoices: [
                        { company: 'Solar Panel Suppliers', amount: '425,000', days: '89 days', logo: 'SP', color: '#ff6b6b' },
                        { company: 'Wind Energy Components', amount: '335,000', days: '72 days', logo: 'WE', color: '#ff9ff3' },
                        { company: 'Battery Storage Systems', amount: '265,000', days: '95 days', logo: 'BS', color: '#feca57' },
                        { company: 'Grid Connection Tech', amount: '189,000', days: '81 days', logo: 'GC', color: '#4ecdc4' }
                    ]
                }
            },
            integrations: {
                erp: [
                    { name: 'Fortnox', connected: false, logo: 'FNOX.ST.svg' },
                    { name: 'Visma', connected: false, logo: 'visma.svg' }
                ],
                openBanking: [
                    { name: 'Swedbank', connected: false, logo: 'SWED-A.ST_BIG.svg' },
                    { name: 'SEB', connected: false, logo: 'seb-1.svg' },
                    { name: 'Nordea', connected: false, logo: 'nordea-markets-vector-logo.svg' },
                    { name: 'Handelsbanken', connected: false, logo: 'handelsbanken-logo-vector.svg' }
                ],
                government: [
                    { name: 'Skatteverket', connected: false, logo: 'Skatteverket_Logo.svg' }
                ],
                crm: [
                    { name: 'HubSpot', connected: false, logo: 'cdnlogo.com_hubspot.svg' },
                    { name: 'Salesforce', connected: false, logo: 'cdnlogo.com_salesforce.svg' }
                ]
            }
        };

        // Navigation Function
        function navigateTo(view) {
            currentView = view;
            const content = document.getElementById('content');
            
            // Remove dashboard class first
            document.body.classList.remove('dashboard-active');
            
            // Hide all nav items first
            document.getElementById('dashboardNav').style.display = 'none';
            document.getElementById('dataNav').style.display = 'none';
            document.getElementById('analyticsNav').style.display = 'none';
            document.getElementById('portfolioNav').style.display = 'none';
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            switch(view) {
                case 'landing':
                    userType = null;
                    renderLanding();
                    break;
                case 'smeLogin':
                    simulateBankIDLogin();
                    break;
                case 'dashboard':
                    userType = 'sme';
                    document.getElementById('dashboardNav').style.display = 'inline-block';
                    document.getElementById('dataNav').style.display = 'inline-block';
                    document.getElementById('analyticsNav').style.display = 'inline-block';
                    document.getElementById('dashboardNav').classList.add('active');
                    document.body.classList.add('dashboard-active');
                    renderSMEDashboard();
                    break;
                case 'connections':
                    // Hide navigation bar during connection flow
                    document.body.classList.add('dashboard-active');
                    // Reset connection flow state when starting
                    if (connectionStep === 1 && completedSteps.length === 0) {
                        connectionStep = 1;
                        completedSteps = [];
                    }
                    renderConnectionHub();
                    break;
                case 'reports':
                    userType = 'sme';
                    document.getElementById('dashboardNav').style.display = 'inline-block';
                    document.getElementById('dataNav').style.display = 'inline-block';
                    document.getElementById('analyticsNav').style.display = 'inline-block';
                    document.body.classList.add('dashboard-active');
                    renderReports();
                    break;
                case 'aiChat':
                    userType = 'sme';
                    document.getElementById('dashboardNav').style.display = 'inline-block';
                    document.getElementById('dataNav').style.display = 'inline-block';
                    document.getElementById('analyticsNav').style.display = 'inline-block';
                    document.body.classList.add('dashboard-active');
                    renderAIChat();
                    break;
                case 'analytics':
                    document.getElementById('dashboardNav').style.display = 'inline-block';
                    document.getElementById('dataNav').style.display = 'inline-block';
                    document.getElementById('analyticsNav').style.display = 'inline-block';
                    document.getElementById('analyticsNav').classList.add('active');
                    renderAnalytics();
                    break;
                case 'lenderLogin':
                    renderLenderLogin();
                    break;
                case 'fspLogin':
                    renderFSPLogin();
                    break;
                case 'fspDashboard':
                    userType = 'fsp';
                    document.getElementById('portfolioNav').style.display = 'inline-block';
                    document.getElementById('portfolioNav').classList.add('active');
                    renderFSPDashboard();
                    break;
                case 'lenderDashboard':
                    userType = 'lender';
                    document.getElementById('portfolioNav').style.display = 'inline-block';
                    document.getElementById('portfolioNav').classList.add('active');
                    renderLenderDashboard();
                    break;
                case 'creditAnalysis':
                    document.getElementById('portfolioNav').style.display = 'inline-block';
                    renderCreditAnalysis();
                    break;
            }
        }

        // Helper function to show navigation bar
        function showNavigationBar() {
            const navBar = document.querySelector('.nav-bar');
            if (navBar) navBar.style.display = 'flex';
        }

        // Render Functions
        function renderLanding() {
            showNavigationBar();
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="landing">
                    <div class="hero">
                        <h1 style="font-weight: 300;">Connect Your Sources</h1>
                        <p>Connect your business data, unlock AI-powered insights, and access better financing</p>
                        <div class="cta-buttons">
                            <button class="btn btn-primary" onclick="navigateTo('smeLogin')">
                                Connect with <img src="bankid-seeklogo.svg" alt="BankID" style="width: 80px; height: 32px; filter: brightness(0) invert(1);">
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSMEDashboard() {
            // Hide navigation bar for SME dashboard
            const navBar = document.querySelector('.nav-bar');
            if (navBar) navBar.style.display = 'none';
            const company = demoData.companies['company-a'];
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="dashboard dashboard-dark">
                    <div class="sidebar">
                        <div class="sidebar-logo">
                            <img src="arcim-logo.svg" alt="Arcim" style="height: 72px; filter: brightness(0) invert(1);">
                        </div>
                        <ul class="sidebar-nav">
                            <li class="sidebar-nav-item active">
                                <img src="house-svgrepo-com.svg" alt="Dashboard" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Dashboard
                            </li>
                            <li class="sidebar-nav-item" onclick="navigateTo('reports')">
                                <img src="reports-svgrepo-com.svg" alt="Reports" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Reports
                            </li>
                            <li class="sidebar-nav-item" onclick="navigateTo('aiChat')">
                                <img src="ai-svgrepo-com.svg" alt="AI Chat" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                AI Chat
                            </li>
                            <li class="sidebar-nav-item">
                                <img src="settings-svgrepo-com.svg" alt="Settings" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Settings
                            </li>
                            <li class="sidebar-nav-item">
                                <img src="help-svgrepo-com.svg" alt="Help" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Help
                            </li>
                        </ul>
                    </div>
                    
                    <div class="main-content">
                        <div class="dashboard-grid">
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Pro-forma DSCR</div>
                                <div class="dashboard-card-value">${company.metrics.proFormaDSCR}</div>
                                <div class="dashboard-card-change">${company.metrics.proFormaDSCRChange}</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Cash Runway</div>
                                <div class="dashboard-card-value">${company.metrics.cashRunway}</div>
                                <div class="dashboard-card-change">${company.metrics.cashRunwayChange}</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Median Net Cash Flow / mo (+ volatility)</div>
                                <div class="dashboard-card-value">${company.metrics.medianNetCashFlow} (${company.metrics.medianNetCashFlowCV})</div>
                                <div class="dashboard-card-change">${company.metrics.medianNetCashFlowChange}</div>
                            </div>
                        </div>
                        
                        <div class="dashboard-large-section">
                            <div class="dashboard-chart">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h3 style="color: #cccccc; font-family: 'Manrope', sans-serif; font-weight: normal; font-size: 0.875rem; margin: 0;">12-month Cash In vs Cash Out vs Net</h3>
                                    <div style="display: flex; gap: 1rem;">
                                        <button id="lastYearBtn" onclick="switchYear('lastYear')" style="background: #5a5a5a; color: #ffffff; border: 1px solid #6a6a6a; padding: 0.5rem 1rem; border-radius: 6px; font-family: 'Manrope', sans-serif; cursor: pointer;">Last year</button>
                                        <button id="thisYearBtn" onclick="switchYear('thisYear')" style="background: transparent; color: #cccccc; border: 1px solid #6a6a6a; padding: 0.5rem 1rem; border-radius: 6px; font-family: 'Manrope', sans-serif; cursor: pointer;">This year</button>
                                    </div>
                                </div>
                                <div id="cashValue" style="font-size: 2rem; font-weight: normal; margin-bottom: 1rem; color: #ffffff; font-family: 'Manrope', sans-serif;">22.4M <span style="font-size: 1rem; color: #4ade80;">+8%</span></div>
                                <div class="chart-bars" style="height: 200px; position: relative; padding: 20px 0 0 0;">
                                    <div style="position: absolute; left: 0; top: 20px; bottom: 0; display: flex; flex-direction: column; justify-content: space-between; color: #666; font-size: 0.875rem; padding: 0 0 0 10px; width: 30px;">
                                        <div>25</div>
                                        <div>20</div>
                                        <div>15</div>
                                        <div>10</div>
                                    </div>
                                    <div id="chartContainer" style="display: flex; align-items: flex-end; justify-content: space-between; height: 100%; width: 100%; padding-left: 30px;">
                                        ${generateDashboardChartBars()}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-table">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h3 style="color: #cccccc; font-family: 'Manrope', sans-serif; font-weight: normal; font-size: 0.875rem; margin: 0;">Largest Unpaid Invoices</h3>
                                </div>
                                ${company.unpaidInvoices.slice(0, 4).map(invoice => `
                                    <div class="invoice-item">
                                        <div class="invoice-company">
                                            <div class="company-logo" style="background: ${invoice.color};">${invoice.logo}</div>
                                            <span>${invoice.company}</span>
                                        </div>
                                        <div class="invoice-amount">
                                            <div>${invoice.amount}</div>
                                            <div class="invoice-days">(${invoice.days})</div>
                                        </div>
                                    </div>
                                `).join('')}
                                <div style="text-align: right; margin-top: 1rem;">
                                    <a href="#" style="color: #fbbf24; text-decoration: none;">See all</a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-grid">
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">DSO</div>
                                <div class="dashboard-card-value">${company.metrics.dso}</div>
                                <div class="dashboard-card-change">${company.metrics.dsoChange}</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">DPO</div>
                                <div class="dashboard-card-value">${company.metrics.dpo}</div>
                                <div class="dashboard-card-change">${company.metrics.dpoChange}</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Cash Conversion Cycle (no inventory)</div>
                                <div class="dashboard-card-value">${company.metrics.cashConversionCycle}</div>
                                <div class="dashboard-card-change">${company.metrics.cashConversionChange}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderReports() {
            // Hide navigation bar for reports
            const navBar = document.querySelector('.nav-bar');
            if (navBar) navBar.style.display = 'none';
            const reports = demoData.reports;
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="dashboard dashboard-dark">
                    <div class="sidebar">
                        <div class="sidebar-logo">
                            <img src="arcim-logo.svg" alt="Arcim" style="height: 72px; filter: brightness(0) invert(1);">
                        </div>
                        <ul class="sidebar-nav">
                            <li class="sidebar-nav-item" onclick="navigateTo('dashboard')">
                                <img src="house-svgrepo-com.svg" alt="Dashboard" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Dashboard
                            </li>
                            <li class="sidebar-nav-item active">
                                <img src="reports-svgrepo-com.svg" alt="Reports" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Reports
                            </li>
                            <li class="sidebar-nav-item" onclick="navigateTo('aiChat')">
                                <img src="ai-svgrepo-com.svg" alt="AI Chat" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                AI Chat
                            </li>
                            <li class="sidebar-nav-item">
                                <img src="settings-svgrepo-com.svg" alt="Settings" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Settings
                            </li>
                            <li class="sidebar-nav-item">
                                <img src="help-svgrepo-com.svg" alt="Help" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Help
                            </li>
                        </ul>
                    </div>
                    
                    <div class="main-content">
                        <!-- Report Header with Download Button -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <div>
                                <h1 style="color: #ffffff; font-family: 'Manrope', sans-serif; font-size: 1.75rem; margin: 0;">Financial Report</h1>
                                <p style="color: #cccccc; font-family: 'Manrope', sans-serif; font-size: 0.875rem; margin: 0.5rem 0 0 0;">Comprehensive analysis and metrics</p>
                            </div>
                            <button class="btn btn-primary" onclick="downloadPDFReport()" style="background: #4A90E2; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; font-family: 'Manrope', sans-serif; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                                ↓ Download PDF Report
                            </button>
                        </div>
                        
                        <!-- Key Metrics Section -->
                        <div class="dashboard-grid">
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Risk Grade</div>
                                <div class="dashboard-card-value">${reports.riskGrade}</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">DSCR (base / downside)</div>
                                <div class="dashboard-card-value">${reports.dscrBase} / ${reports.dscrDownside}</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Runway</div>
                                <div class="dashboard-card-value">${reports.runway}</div>
                            </div>
                        </div>
                        
                        <!-- Financial Details Section -->
                        <div class="dashboard-grid" style="margin-top: 1.5rem;">
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Median net CF/mo</div>
                                <div class="dashboard-card-value">${reports.medianNetCF}</div>
                                <div class="dashboard-card-change" style="color: #cccccc; font-weight: normal;">(${reports.medianNetCFDetails})</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Working capital</div>
                                <div class="dashboard-card-value" style="font-size: 1.2rem;">DSO ${reports.dso} • DPO ${reports.dpo} • CCC ${reports.ccc}</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Concentration</div>
                                <div class="dashboard-card-value" style="font-size: 1.2rem;">${reports.concentration}</div>
                            </div>
                        </div>
                        
                        <!-- Aging Analysis Section -->
                        <div class="dashboard-grid" style="margin-top: 1.5rem;">
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">AR aging</div>
                                <div class="dashboard-card-value" style="font-size: 1.5rem;">${reports.arTotal} total</div>
                                <div class="dashboard-card-change" style="color: #cccccc; font-weight: normal;">${reports.arAging}</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">AP aging</div>
                                <div class="dashboard-card-value" style="font-size: 1.5rem;">${reports.apTotal} total</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Compliance</div>
                                <div class="dashboard-card-value" style="font-size: 1.2rem;">${reports.compliance}</div>
                            </div>
                        </div>
                        
                        <!-- Debt Service Section -->
                        <div class="dashboard-large-section" style="margin-top: 1.5rem;">
                            <div class="dashboard-chart">
                                <div style="margin-bottom: 1rem;">
                                    <h3 style="color: #cccccc; font-family: 'Manrope', sans-serif; font-weight: normal; font-size: 0.875rem; margin: 0 0 1rem 0;">Debt Service</h3>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                                    <div>
                                        <div style="color: #cccccc; font-size: 0.875rem; margin-bottom: 0.5rem;">Existing</div>
                                        <div style="color: #ffffff; font-size: 1.5rem; font-family: 'Manrope', sans-serif;">${reports.existingDebt}</div>
                                    </div>
                                    <div>
                                        <div style="color: #cccccc; font-size: 0.875rem; margin-bottom: 0.5rem;">Proposed loan</div>
                                        <div style="color: #ffffff; font-size: 1.2rem; font-family: 'Manrope', sans-serif;">${reports.proposedLoan}</div>
                                        <div style="color: #ffffff; font-size: 1.5rem; font-family: 'Manrope', sans-serif; margin-top: 0.5rem;">→ ${reports.proposedPayment}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-chart">
                                <div style="margin-bottom: 1rem;">
                                    <h3 style="color: #cccccc; font-family: 'Manrope', sans-serif; font-weight: normal; font-size: 0.875rem; margin: 0 0 1rem 0;">Cash flow series (12 mo)</h3>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
                                    <div>
                                        <div style="color: #cccccc; font-size: 0.875rem; margin-bottom: 0.5rem;">Cash in</div>
                                        <div style="color: #ffffff; font-size: 1.5rem; font-family: 'Manrope', sans-serif;">${reports.cashFlowSeries.cashIn}</div>
                                    </div>
                                    <div>
                                        <div style="color: #cccccc; font-size: 0.875rem; margin-bottom: 0.5rem;">Cash out</div>
                                        <div style="color: #ffffff; font-size: 1.5rem; font-family: 'Manrope', sans-serif;">${reports.cashFlowSeries.cashOut}</div>
                                    </div>
                                    <div>
                                        <div style="color: #cccccc; font-size: 0.875rem; margin-bottom: 0.5rem;">Net</div>
                                        <div style="color: #4ade80; font-size: 1.5rem; font-family: 'Manrope', sans-serif;">${reports.cashFlowSeries.net}</div>
                                    </div>
                                </div>
                                <div style="color: #cccccc; font-size: 0.875rem; margin-top: 1rem; font-style: italic;">${reports.cashFlowSeries.trend}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAIChat() {
            // Hide navigation bar for AI chat
            const navBar = document.querySelector('.nav-bar');
            if (navBar) navBar.style.display = 'none';
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="dashboard dashboard-dark">
                    <div class="sidebar">
                        <div class="sidebar-logo">
                            <img src="arcim-logo.svg" alt="Arcim" style="height: 72px; filter: brightness(0) invert(1);">
                        </div>
                        <ul class="sidebar-nav">
                            <li class="sidebar-nav-item" onclick="navigateTo('dashboard')">
                                <img src="house-svgrepo-com.svg" alt="Dashboard" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Dashboard
                            </li>
                            <li class="sidebar-nav-item" onclick="navigateTo('reports')">
                                <img src="reports-svgrepo-com.svg" alt="Reports" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Reports
                            </li>
                            <li class="sidebar-nav-item active">
                                <img src="ai-svgrepo-com.svg" alt="AI Chat" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                AI Chat
                            </li>
                            <li class="sidebar-nav-item">
                                <img src="settings-svgrepo-com.svg" alt="Settings" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Settings
                            </li>
                            <li class="sidebar-nav-item">
                                <img src="help-svgrepo-com.svg" alt="Help" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Help
                            </li>
                        </ul>
                    </div>
                    
                    <div class="main-content">
                        <!-- Chat Header -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <div>
                                <h1 style="color: #ffffff; font-family: 'Manrope', sans-serif; font-size: 1.75rem; margin: 0;">AI Financial Assistant</h1>
                                <p style="color: #cccccc; font-family: 'Manrope', sans-serif; font-size: 0.875rem; margin: 0.5rem 0 0 0;">Ask questions about your financial data and get instant insights</p>
                            </div>
                        </div>
                        
                        <!-- Chat Interface -->
                        <div class="dashboard-chart" style="height: calc(100vh - 200px); display: flex; flex-direction: column;">
                            <!-- Chat Messages Area -->
                            <div id="chatMessages" style="flex: 1; overflow-y: auto; padding: 1.5rem; margin-bottom: 1rem; max-height: 500px;">
                                <!-- Welcome Message -->
                                <div style="display: flex; align-items: flex-start; margin-bottom: 1rem;">
                                    <div style="background: #4A90E2; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; flex-shrink: 0;">
                                        <img src="ai-svgrepo-com.svg" alt="AI" style="height: 16px; width: 16px; filter: brightness(0) invert(1);">
                                    </div>
                                    <div style="background: rgba(74, 144, 226, 0.2); padding: 0.75rem 1rem; border-radius: 12px 12px 12px 4px; max-width: 70%;">
                                        <p style="color: #ffffff; margin: 0; font-family: 'Manrope', sans-serif; font-size: 0.875rem;">
                                            Hello! I'm your AI financial assistant. I can help you analyze your financial data, explain metrics, and answer questions about your company's performance. What would you like to know?
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Chat Input Area -->
                            <div style="display: flex; gap: 0.75rem; padding: 0 1.5rem 1.5rem;">
                                <input 
                                    type="text" 
                                    id="chatInput" 
                                    placeholder="Ask about your financial metrics, cash flow, or risk analysis..."
                                    style="flex: 1; padding: 0.75rem 1rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: #ffffff; font-family: 'Manrope', sans-serif; font-size: 0.875rem;"
                                    onkeypress="if(event.key === 'Enter') sendMessage()"
                                >
                                <button 
                                    onclick="sendMessage()" 
                                    style="background: #4A90E2; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-family: 'Manrope', sans-serif; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;"
                                >
                                    Send
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderConnectionHub() {
            const content = document.getElementById('content');
            
            // Step configuration
            const steps = [
                { id: 1, title: 'Choose your ERP System', category: 'erp' },
                { id: 2, title: 'Choose your Open Banking', category: 'openBanking' },
                { id: 3, title: 'Connect to Government Source', category: 'government' },
                { id: 4, title: 'Choose your CRM System', category: 'crm' }
            ];
            
            const currentStepConfig = steps[connectionStep - 1];
            const currentIntegrations = demoData.integrations[currentStepConfig.category];
            const isLastStep = connectionStep === 4;
            const allStepsCompleted = completedSteps.length === 4;
            
            content.innerHTML = `
                <div class="connection-hub">
                    <h1 style="margin: 2rem 0; text-align: center; font-weight: 300;">Connect Your Business Data</h1>
                    
                    ${generateProgressBar()}
                    
                    <div class="integration-section">
                        <h2 style="text-align: center; margin-bottom: 2rem; color: #000; font-weight: 300;">${currentStepConfig.title}</h2>
                        
                        <div class="integration-grid">
                            ${currentIntegrations.map(int => `
                                <div class="integration-card ${connectedSources.includes(int.name) ? 'connected' : ''}" 
                                     onclick="connectIntegration('${int.name}')">
                                    <div class="integration-logo">
                                        <img src="${int.logo}" alt="${int.name}" style="width: 60px; height: 60px; object-fit: contain;">
                                    </div>
                                    <div class="integration-name">${int.name}</div>
                                    <div class="integration-status">
                                        ${connectedSources.includes(int.name) ? 'Connected' : 
                                          (currentStepConfig.category === 'government' ? 'Connect with BankID' : 'Click to connect')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 2rem; margin-top: 3rem;">
                        ${connectionStep > 1 ? `
                            <button class="btn btn-secondary" onclick="previousStep()" style="padding: 1rem 2rem;">
                                ← Previous Step
                            </button>
                        ` : ''}
                        
                        ${getStepHasSelection() ? `
                            <button class="btn btn-primary" onclick="nextStep()" style="padding: 1rem 2rem;">
                                ${isLastStep ? 'Complete Setup' : 'Next Step →'}
                            </button>
                        ` : ''}
                    </div>
                    
                    ${connectionStep > 1 ? `
                        <div style="text-align: center; margin-top: 2rem;">
                            <button class="btn btn-secondary" onclick="navigateTo('dashboard')" style="background: transparent; color: #666; border: none; text-decoration: underline;">
                                Skip remaining steps and go to dashboard
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderDataProcessing() {
            const content = document.getElementById('content');
            const processingSteps = [
                'Normalizing data',
                'Mapping chart of accounts', 
                'Reconciling currency & time',
                'Enriching entities & tags',
                'Validating lineage',
                'Publishing Semantic Layer',
                'Generating MCP tools'
            ];

            content.innerHTML = `
                <div class="connection-hub" style="background: #000000; min-height: 100vh; display: flex; align-items: center; justify-content: center;">
                    <div style="text-align: center; max-width: 600px; width: 100%;">
                        <div style="margin-bottom: 3rem;">
                            <img src="arcim-logo.svg" alt="Arcim" style="height: 60px; filter: brightness(0) invert(1); margin-bottom: 2rem;">
                            <h1 style="font-weight: 300; color: #ffffff; margin-bottom: 1rem;">Setting up your workspace</h1>
                            <p style="color: #cccccc;">Please wait while we process and optimize your data...</p>
                        </div>
                        
                        <div class="processing-steps">
                            ${processingSteps.map((step, index) => `
                                <div class="processing-step" data-step="${index}">
                                    <div class="processing-indicator">
                                        <div class="processing-dot"></div>
                                    </div>
                                    <span class="processing-text">${step}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            // Start processing animation
            animateProcessingSteps(processingSteps.length);
        }

        function animateProcessingSteps(totalSteps) {
            let currentStep = 0;
            
            function processNextStep() {
                if (currentStep < totalSteps) {
                    const stepElement = document.querySelector(`.processing-step[data-step="${currentStep}"]`);
                    if (stepElement) {
                        stepElement.classList.add('processing');
                        
                        setTimeout(() => {
                            stepElement.classList.remove('processing');
                            stepElement.classList.add('completed');
                            currentStep++;
                            
                            if (currentStep < totalSteps) {
                                setTimeout(processNextStep, 300);
                            } else {
                                // All steps completed, navigate to dashboard after a brief delay
                                setTimeout(() => {
                                    navigateTo('dashboard');
                                }, 1000);
                            }
                        }, 800);
                    }
                } 
            }
            
            // Start the first step after a brief delay
            setTimeout(processNextStep, 500);
        }

        // Chart data for different years
        const chartData = {
            lastYear: {
                heights: [55, 68, 75, 95, 72, 89, 78, 65, 82, 69, 76, 71],
                value: '22.4M',
                change: '+8%'
            },
            thisYear: {
                heights: [48, 62, 70, 88, 66, 82, 71, 59, 75, 63, 69, 64],
                value: '21.5M',
                change: '+2%'
            }
        };

        let currentYear = 'lastYear';

        // Helper functions for dashboard
        function generateDashboardChartBars(year = 'lastYear') {
            const heights = chartData[year].heights;
            return heights.map((height, index) => `
                <div class="chart-bar" style="height: ${height}%; 
                     background: linear-gradient(180deg, #f4c430 0%, #daa520 100%); 
                     width: 40px; border-radius: 4px 4px 0 0; margin: 0 4px; 
                     animation: growBar 0.8s ease-out forwards; animation-delay: ${index * 0.05}s;
                     box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);">
                </div>
            `).join('');
        }

        function switchYear(year) {
            currentYear = year;
            const cashValue = document.getElementById('cashValue');
            const chartContainer = document.getElementById('chartContainer');
            const lastYearBtn = document.getElementById('lastYearBtn');
            const thisYearBtn = document.getElementById('thisYearBtn');
            
            // Update button styles
            if (year === 'lastYear') {
                lastYearBtn.style.background = '#5a5a5a';
                lastYearBtn.style.color = '#ffffff';
                thisYearBtn.style.background = 'transparent';
                thisYearBtn.style.color = '#cccccc';
            } else {
                thisYearBtn.style.background = '#5a5a5a';
                thisYearBtn.style.color = '#ffffff';
                lastYearBtn.style.background = 'transparent';
                lastYearBtn.style.color = '#cccccc';
            }
            
            // Update cash value
            const data = chartData[year];
            cashValue.innerHTML = `${data.value} <span style="font-size: 1rem; color: #4ade80;">${data.change}</span>`;
            
            // Update chart
            chartContainer.innerHTML = generateDashboardChartBars(year);
        }

        // Helper functions for connection flow
        function generateProgressBar() {
            const steps = [
                { label: 'ERP System' },
                { label: 'Open Banking' },
                { label: 'Government' },
                { label: 'CRM System' }
            ];
            
            return `
                <div class="progress-container">
                    <div class="progress-bar">
                        ${steps.map((step, index) => {
                            const stepNumber = index + 1;
                            const isCompleted = completedSteps.includes(stepNumber);
                            const isCurrent = connectionStep === stepNumber;
                            const circleClass = isCompleted ? 'completed' : (isCurrent ? 'current' : 'pending');
                            const labelClass = isCurrent ? 'current' : '';
                            
                            return `
                                <div class="progress-step">
                                    <div class="progress-circle ${circleClass}">
                                        ${isCompleted ? '✓' : stepNumber}
                                    </div>
                                    <div class="progress-label ${labelClass}">${step.label}</div>
                                </div>
                                ${index < steps.length - 1 ? `<div class="progress-connector ${isCompleted ? 'completed' : ''}"></div>` : ''}
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }
        
        function getStepHasSelection() {
            const steps = ['erp', 'openBanking', 'government', 'crm'];
            const currentCategory = steps[connectionStep - 1];
            const categoryIntegrations = demoData.integrations[currentCategory];
            
            return categoryIntegrations.some(int => connectedSources.includes(int.name));
        }
        
        function nextStep() {
            if (connectionStep < 4) {
                if (!completedSteps.includes(connectionStep)) {
                    completedSteps.push(connectionStep);
                }
                connectionStep++;
                renderConnectionHub();
            } else {
                // All steps completed, show processing screen
                if (!completedSteps.includes(4)) {
                    completedSteps.push(4);
                }
                renderDataProcessing();
            }
        }
        
        function previousStep() {
            if (connectionStep > 1) {
                connectionStep--;
                renderConnectionHub();
            }
        }

        function renderAnalytics() {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="connection-hub">
                    <button class="btn btn-secondary" onclick="navigateTo('dashboard')">← Back to Dashboard</button>
                    
                    <h1 style="margin: 2rem 0;">Analytics & Reports</h1>
                    
                    <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                        <select style="padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px;">
                            <option>Last 12 months</option>
                            <option>Last Quarter</option>
                            <option>YTD</option>
                        </select>
                        <button class="btn btn-primary">Generate Report</button>
                        <button class="btn btn-secondary">Export PDF</button>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title">Revenue Analysis</div>
                        </div>
                        <div class="chart-bars">
                            ${generateChartBars()}
                        </div>
                        <div style="text-align: center; margin-top: 1rem; color: #666;">
                            Growth Rate: 12% | Average: 2.1M | Peak: 2.4M
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                        <div class="insights-panel">
                            <div class="insights-title">Customer Metrics</div>
                            <div style="padding: 1rem;">
                                <div style="margin-bottom: 1rem;">
                                    <strong>CAC:</strong> 2,450 SEK
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <strong>LTV:</strong> 15,600 SEK
                                </div>
                                <div>
                                    <strong>Churn Rate:</strong> 11%
                                </div>
                            </div>
                        </div>
                        
                        <div class="insights-panel">
                            <div class="insights-title">Financial Health</div>
                            <div style="padding: 1rem;">
                                <div style="margin-bottom: 1rem;">
                                    <strong>Profit Margin:</strong> 14.2%
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <strong>Burn Rate:</strong> -85K/month
                                </div>
                                <div>
                                    <strong>Runway:</strong> 5.3 months
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container" style="margin-top: 2rem;">
                        <div class="chart-header">
                            <div class="chart-title">Expense Breakdown</div>
                        </div>
                        <div style="display: flex; justify-content: space-around; padding: 2rem;">
                            <div style="text-align: center;">
                                <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #4A90E2, #357ABD); 
                                            border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; 
                                            justify-content: center; color: white; font-size: 1.5rem; font-weight: bold;">
                                    45%
                                </div>
                                <div>Operations</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #48C774, #3ABB67); 
                                            border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; 
                                            justify-content: center; color: white; font-size: 1.25rem; font-weight: bold;">
                                    30%
                                </div>
                                <div>Sales</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #FFC107, #FFB300); 
                                            border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; 
                                            justify-content: center; color: white; font-size: 1rem; font-weight: bold;">
                                    15%
                                </div>
                                <div>Marketing</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #FF5252, #E53935); 
                                            border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; 
                                            justify-content: center; color: white; font-size: 0.875rem; font-weight: bold;">
                                    10%
                                </div>
                                <div>Other</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 3rem;">
                        <h3>Quick Reports</h3>
                        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
                            <button class="btn btn-primary">Monthly Report</button>
                            <button class="btn btn-secondary">Quarterly Report</button>
                            <button class="btn btn-secondary">Custom Report</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLenderLogin() {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="landing">
                    <div class="hero">
                        <h2>Lender Portal</h2>
                        <p>Access comprehensive SME credit analysis and portfolio management</p>
                        <div style="max-width: 400px; margin: 2rem auto;">
                            <input type="text" placeholder="Username" style="width: 100%; padding: 1rem; margin-bottom: 1rem; 
                                   border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                            <input type="password" placeholder="Password" style="width: 100%; padding: 1rem; margin-bottom: 1rem; 
                                   border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                            <button class="btn btn-primary" style="width: 100%;" onclick="simulateLenderLogin()">
                                Login
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderFSPLogin() {
            showNavigationBar();
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="landing">
                    <div class="hero">
                        <h2>Financial Service Provider Portal</h2>
                        <p>Access comprehensive portfolio management and SME analytics</p>
                        <div style="max-width: 400px; margin: 2rem auto;">
                            <input type="text" placeholder="FSP Username" style="width: 100%; padding: 1rem; margin-bottom: 1rem; 
                                   border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                            <input type="password" placeholder="Password" style="width: 100%; padding: 1rem; margin-bottom: 1rem; 
                                   border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                            <button class="btn btn-primary" style="width: 100%;" onclick="simulateFSPLogin()">
                                Login
                            </button>
                            <div style="text-align: center; margin-top: 1rem;">
                                <a href="#" onclick="navigateTo('landing')" style="color: #666; text-decoration: none; font-size: 0.875rem;">← Back to main page</a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderFSPDashboard() {
            // Hide navigation bar for FSP portal
            const navBar = document.querySelector('.nav-bar');
            if (navBar) navBar.style.display = 'none';
            
            const content = document.getElementById('content');
            const companies = demoData.companies;
            const totalCompanies = Object.keys(companies).length;
            const lowRisk = Object.values(companies).filter(c => c.riskLevel === 'Low').length;
            const mediumRisk = Object.values(companies).filter(c => c.riskLevel === 'Medium').length;
            const highRisk = Object.values(companies).filter(c => c.riskLevel === 'High').length;
            
            content.innerHTML = `
                <div class="dashboard dashboard-dark">
                    <div class="sidebar">
                        <div class="sidebar-logo">
                            <img src="arcim-logo.svg" alt="Arcim" style="height: 75px; filter: brightness(0) invert(1);">
                        </div>
                        <ul class="sidebar-nav">
                            <li class="sidebar-nav-item active">
                                <img src="house-svgrepo-com.svg" alt="Portfolio" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Portfolio
                            </li>
                            <li class="sidebar-nav-item" onclick="renderFSPCompanyView()">
                                <img src="reports-svgrepo-com.svg" alt="Company View" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Company View
                            </li>
                            <li class="sidebar-nav-item">
                                <img src="settings-svgrepo-com.svg" alt="Settings" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Settings
                            </li>
                            <li class="sidebar-nav-item">
                                <img src="help-svgrepo-com.svg" alt="Help" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Help
                            </li>
                        </ul>
                    </div>
                    
                    <div class="main-content">
                        <!-- FSP Header with Company Selector -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <div>
                                <h1 style="color: #ffffff; font-family: 'Manrope', sans-serif; font-size: 1.75rem; margin: 0;">Portfolio Overview</h1>
                                
                            </div>
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <select id="companySelector" onchange="switchFSPCompany(this.value)" style="background: #5a5a5a; color: #ffffff; border: 1px solid #6a6a6a; padding: 0.75rem 1rem; border-radius: 6px; font-family: 'Manrope', sans-serif;">
                                    <option value="">Select Company to View</option>
                                    ${Object.entries(companies).map(([key, company]) => `
                                        <option value="${key}">${company.name} (${company.industry})</option>
                                    `).join('')}
                                </select>
                                <button onclick="renderFSPCompanyView()" style="background: #4A90E2; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; font-family: 'Manrope', sans-serif; cursor: pointer;">
                                    View Selected Company
                                </button>
                            </div>
                        </div>
                        
                        <!-- Portfolio Stats -->
                        <div class="dashboard-grid">
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Total Companies</div>
                                <div class="dashboard-card-value">${totalCompanies}</div>
                                <div class="dashboard-card-change" style="color: #cccccc;">Active Portfolio</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Low Risk</div>
                                <div class="dashboard-card-value" style="color: #4ade80;">${lowRisk}</div>
                                <div class="dashboard-card-change" style="color: #cccccc;">Companies</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Medium Risk</div>
                                <div class="dashboard-card-value" style="color: #fbbf24;">${mediumRisk}</div>
                                <div class="dashboard-card-change" style="color: #cccccc;">Companies</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">High Risk</div>
                                <div class="dashboard-card-value" style="color: #ef4444;">${highRisk}</div>
                                <div class="dashboard-card-change" style="color: #cccccc;">Companies</div>
                            </div>
                        </div>
                        
                        <!-- Companies Table -->
                        <div style="margin-top: 2rem; width: 100%;">
                            <div class="dashboard-chart">
                                <div style="margin-bottom: 1rem;">
                                    <h3 style="color: #cccccc; font-family: 'Manrope', sans-serif; font-weight: normal; font-size: 0.875rem; margin: 0 0 1rem 0;">Company Portfolio</h3>
                                </div>
                                <div style="overflow-x: auto;">
                                    <table style="width: 100%; border-collapse: collapse; color: #ffffff; font-family: 'Manrope', sans-serif;">
                                        <thead>
                                            <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.2); background: transparent;">
                                                <th style="padding: 1rem; text-align: left; color: #cccccc; font-size: 0.875rem; background: transparent;">Company</th>
                                                <th style="padding: 1rem; text-align: left; color: #cccccc; font-size: 0.875rem; background: transparent;">Industry</th>
                                                <th style="padding: 1rem; text-align: left; color: #cccccc; font-size: 0.875rem; background: transparent;">Risk Score</th>
                                                <th style="padding: 1rem; text-align: left; color: #cccccc; font-size: 0.875rem; background: transparent;">Risk Level</th>
                                                <th style="padding: 1rem; text-align: left; color: #cccccc; font-size: 0.875rem; background: transparent;">Loan Amount</th>
                                                <th style="padding: 1rem; text-align: left; color: #cccccc; font-size: 0.875rem; background: transparent;">DSCR</th>
                                                <th style="padding: 1rem; text-align: left; color: #cccccc; font-size: 0.875rem; background: transparent;">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${Object.entries(companies).map(([key, company]) => `
                                                <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                                    <td style="padding: 1rem; font-size: 0.875rem;">${company.name}</td>
                                                    <td style="padding: 1rem; font-size: 0.875rem;">${company.industry}</td>
                                                    <td style="padding: 1rem; font-size: 0.875rem;">${company.riskScore}/100</td>
                                                    <td style="padding: 1rem; font-size: 0.875rem;">
                                                        <span style="padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; background: ${
                                                            company.riskLevel === 'Low' ? 'rgba(74, 222, 128, 0.2); color: #4ade80' :
                                                            company.riskLevel === 'Medium' ? 'rgba(251, 191, 36, 0.2); color: #fbbf24' :
                                                            'rgba(239, 68, 68, 0.2); color: #ef4444'
                                                        };">
                                                            ${company.riskLevel}
                                                        </span>
                                                    </td>
                                                    <td style="padding: 1rem; font-size: 0.875rem;">${company.loanAmount}</td>
                                                    <td style="padding: 1rem; font-size: 0.875rem;">${company.metrics.proFormaDSCR}</td>
                                                    <td style="padding: 1rem; font-size: 0.875rem;">
                                                        <button onclick="switchFSPCompany('${key}'); renderFSPCompanyView();" style="background: #4A90E2; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; font-size: 0.75rem; cursor: pointer;">
                                                            View Details
                                                        </button>
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLenderDashboard() {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="main-content" style="padding: 2rem; max-width: 1200px; margin: 0 auto;">
                    <h1 style="margin-bottom: 2rem;">Portfolio Overview</h1>
                    
                    <div class="portfolio-stats">
                        <div class="stat-card">
                            <div class="stat-value">247</div>
                            <div class="stat-label">Total SMEs</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #FFC107;">Medium</div>
                            <div class="stat-label">Average Risk</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">450M</div>
                            <div class="stat-label">Portfolio Value (SEK)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #48C774;">92%</div>
                            <div class="stat-label">Approval Rate</div>
                        </div>
                    </div>
                    
                    <div class="data-table" style="margin-top: 2rem;">
                        <div class="table-header">SME Applications</div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Company</th>
                                    <th>Industry</th>
                                    <th>Amount</th>
                                    <th>Risk Level</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(demoData.companies).map(([key, company]) => `
                                    <tr onclick="selectCompany('${key}')">
                                        <td><strong>${company.name}</strong></td>
                                        <td>${company.industry}</td>
                                        <td>${company.loanAmount}</td>
                                        <td><span class="risk-badge risk-${company.riskLevel.toLowerCase()}">${company.riskLevel}</span></td>
                                        <td><button class="btn btn-primary" style="padding: 0.5rem 1rem;">View →</button></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="chart-container" style="margin-top: 2rem;">
                        <div class="chart-header">
                            <div class="chart-title">Risk Distribution</div>
                        </div>
                        <div style="padding: 2rem;">
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <div style="width: 200px; height: 30px; background: linear-gradient(90deg, #48C774 0%, #48C774 45%, #e9ecef 45%); 
                                                border-radius: 15px;"></div>
                                    <span>Low: 45%</span>
                                </div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <div style="width: 200px; height: 30px; background: linear-gradient(90deg, #FFC107 0%, #FFC107 35%, #e9ecef 35%); 
                                                border-radius: 15px;"></div>
                                    <span>Medium: 35%</span>
                                </div>
                            </div>
                            <div>
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <div style="width: 200px; height: 30px; background: linear-gradient(90deg, #FF5252 0%, #FF5252 20%, #e9ecef 20%); 
                                                border-radius: 15px;"></div>
                                    <span>High: 20%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCreditAnalysis() {
            const company = demoData.companies[selectedCompany];
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="credit-analysis">
                    <button class="btn btn-secondary" onclick="navigateTo('lenderDashboard')">← Back to Portfolio</button>
                    
                    <h1 style="margin: 2rem 0;">${company.name} - Credit Analysis</h1>
                    
                    <div class="analysis-header">
                        <div class="risk-score-container">
                            <div class="risk-score" style="color: ${company.riskScore > 70 ? '#48C774' : company.riskScore > 50 ? '#FFC107' : '#FF5252'}">
                                ${company.riskScore}/100
                            </div>
                            <div class="risk-label" style="color: ${company.riskScore > 70 ? '#48C774' : company.riskScore > 50 ? '#FFC107' : '#FF5252'}">
                                ${company.riskLevel.toUpperCase()} RISK
                            </div>
                        </div>
                        
                        <div class="financial-summary">
                            <div class="summary-item">
                                <div class="summary-label">Revenue</div>
                                <div class="summary-value">${company.metrics.revenue} (${company.metrics.revenueChange})</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Profit Margin</div>
                                <div class="summary-value">${company.metrics.profitMargin}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Cash Flow</div>
                                <div class="summary-value">${company.metrics.cashFlow}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Customer Count</div>
                                <div class="summary-value">${company.metrics.customers}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="insights-panel">
                        <div class="insights-title">Risk Assessment</div>
                        <div class="insight-item">
                            <span class="insight-icon">✓</span>
                            <div>Stable cash flow patterns detected over last 12 months</div>
                        </div>
                        <div class="insight-item">
                            <span class="insight-icon">✓</span>
                            <div>Consistent revenue growth (${company.metrics.revenueChange} YoY)</div>
                        </div>
                        <div class="insight-item">
                            <span class="insight-icon">⚠</span>
                            <div>Seasonal dips in Q4 require attention</div>
                        </div>
                        <div class="insight-item">
                            <span class="insight-icon">✓</span>
                            <div>Strong customer retention (89%)</div>
                        </div>
                        <div class="insight-item">
                            <span class="insight-icon">✓</span>
                            <div>Debt-to-equity ratio healthy at 0.4</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-top: 2rem;">
                        <div class="chart-container">
                            <div class="chart-title">Cash Flow Trend</div>
                            <div class="chart-placeholder" style="height: 200px;">
                                <canvas id="cashFlowChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Revenue Growth</div>
                            <div class="chart-placeholder" style="height: 200px;">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container" style="margin-top: 2rem;">
                        <div class="chart-header">
                            <div class="chart-title">Documents</div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; padding: 1rem;">
                            <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                📄 Annual Report 2023
                            </div>
                            <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                📄 Tax Returns
                            </div>
                            <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                📄 Bank Statements
                            </div>
                            <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                📄 Accounting Summary
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 3rem;">
                        <button class="btn btn-success" style="padding: 1rem 2rem;" onclick="showApprovalModal()">
                            ✓ Approve
                        </button>
                        <button class="btn btn-primary" style="padding: 1rem 2rem;">
                            📋 Request More Info
                        </button>
                        <button class="btn btn-secondary" style="padding: 1rem 2rem;">
                            ✗ Decline
                        </button>
                    </div>
                </div>
            `;
            
            // Simulate chart drawing
            setTimeout(() => {
                const cashCanvas = document.getElementById('cashFlowChart');
                const revCanvas = document.getElementById('revenueChart');
                if (cashCanvas && revCanvas) {
                    drawSimpleChart(cashCanvas);
                    drawSimpleChart(revCanvas);
                }
            }, 100);
        }

        // Helper Functions
        function generateChartBars() {
            const heights = [60, 65, 70, 68, 72, 75, 78, 82, 85, 88, 92, 95];
            return heights.map((height, index) => `
                <div class="chart-bar" style="height: ${height}%; animation-delay: ${index * 0.1}s;">
                    <span style="position: absolute; top: -20px; font-size: 0.75rem; color: #666;">
                        ${1.8 + (index * 0.05)}M
                    </span>
                </div>
            `).join('');
        }

        function drawSimpleChart(canvas) {
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = 200;
            
            ctx.beginPath();
            ctx.strokeStyle = '#4A90E2';
            ctx.lineWidth = 3;
            
            const points = [];
            for (let i = 0; i < 12; i++) {
                const x = (i / 11) * canvas.width;
                const y = canvas.height - (Math.random() * 100 + 50);
                points.push({ x, y });
            }
            
            ctx.moveTo(points[0].x, points[0].y);
            points.forEach(point => {
                ctx.lineTo(point.x, point.y);
            });
            ctx.stroke();
            
            // Fill area under line
            ctx.lineTo(canvas.width, canvas.height);
            ctx.lineTo(0, canvas.height);
            ctx.closePath();
            ctx.fillStyle = 'rgba(74, 144, 226, 0.1)';
            ctx.fill();
        }

        function simulateBankIDLogin() {
            showModal(
                'BankID Authentication',
                '<div style="text-align: center;"><div class="loading"></div><p style="margin-top: 1rem;">Authenticating with BankID...</p></div>',
                ''
            );
            
            setTimeout(() => {
                closeModal();
                showModal(
                    'Welcome!',
                    '<p>BankID authentication successful!</p><p style="margin-top: 1rem;">Next, let\'s connect your business data sources to get started.</p>',
                    '<button class="btn btn-primary" onclick="closeModal(); navigateTo(\'connections\')">Continue</button>'
                );
            }, 2000);
        }

        function simulateLenderLogin() {
            showModal(
                'Authenticating',
                '<div style="text-align: center;"><div class="loading"></div><p style="margin-top: 1rem;">Logging in...</p></div>',
                ''
            );
            
            setTimeout(() => {
                closeModal();
                navigateTo('lenderDashboard');
            }, 1500);
        }

        function simulateFSPLogin() {
            showModal(
                'Authenticating',
                '<div style="text-align: center;"><div class="loading"></div><p style="margin-top: 1rem;">Verifying FSP credentials...</p></div>',
                ''
            );
            
            setTimeout(() => {
                closeModal();
                navigateTo('fspDashboard');
            }, 2000);
        }

        function connectIntegration(name) {
            if (connectedSources.includes(name)) {
                showModal(
                    'Already Connected',
                    `${name} is already connected to your account.`,
                    '<button class="btn btn-primary" onclick="closeModal()">OK</button>'
                );
                return;
            }
            
            showModal(
                `Connect ${name}`,
                `<div style="text-align: center;">
                    <div class="loading"></div>
                    <p style="margin-top: 1rem;">Redirecting to ${name} for authentication...</p>
                    <p style="color: #666; font-size: 0.875rem; margin-top: 0.5rem;">This is a demo - simulating OAuth flow</p>
                </div>`,
                ''
            );
            
            setTimeout(() => {
                connectedSources.push(name);
                closeModal();
                showModal(
                    'Success!',
                    `${name} has been successfully connected. Your data will sync shortly.`,
                    '<button class="btn btn-primary" onclick="closeModal(); renderConnectionHub()">Done</button>'
                );
            }, 3000);
        }

        function selectCompany(companyKey) {
            selectedCompany = companyKey;
            navigateTo('creditAnalysis');
        }

        function showDemoInfo() {
            showModal(
                'About Arcim',
                `<p>Arcim is revolutionizing how Swedish SMEs manage and share their business data.</p>
                <p style="margin-top: 1rem;"><strong>For SMEs:</strong></p>
                <ul style="margin-left: 1.5rem;">
                    <li>Connect all your business data sources in one place</li>
                    <li>Get AI-powered insights and predictions</li>
                    <li>Share verified data with lenders instantly</li>
                </ul>
                <p style="margin-top: 1rem;"><strong>For Lenders:</strong></p>
                <ul style="margin-left: 1.5rem;">
                    <li>Access comprehensive, real-time SME data</li>
                    <li>Automated risk assessment and credit scoring</li>
                    <li>Reduce decision time from days to minutes</li>
                </ul>`,
                '<button class="btn btn-primary" onclick="closeModal()">Got it</button>'
            );
        }

        function showExportModal() {
            showModal(
                'Export Data',
                `<p>Select export format:</p>
                <div style="margin-top: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="radio" name="format" checked> PDF Report
                    </label>
                    <label style="display: block; margin-bottom: 0.5rem;">
                        <input type="radio" name="format"> Excel Spreadsheet
                    </label>
                    <label style="display: block;">
                        <input type="radio" name="format"> CSV Data
                    </label>
                </div>`,
                `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="simulateExport()">Export</button>`
            );
        }

        function showApprovalModal() {
            showModal(
                'Approve Loan Application',
                `<p>You are about to approve the loan application for <strong>${demoData.companies[selectedCompany].name}</strong>.</p>
                <p style="margin-top: 1rem;">Loan Amount: <strong>${demoData.companies[selectedCompany].loanAmount}</strong></p>
                <p>Risk Level: <strong>${demoData.companies[selectedCompany].riskLevel}</strong></p>`,
                `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-success" onclick="confirmApproval()">Confirm Approval</button>`
            );
        }

        function confirmApproval() {
            closeModal();
            showModal(
                'Success',
                'Loan application has been approved. The customer will be notified shortly.',
                '<button class="btn btn-primary" onclick="closeModal(); navigateTo(\'lenderDashboard\')">Back to Portfolio</button>'
            );
        }

        function downloadPDFReport() {
            // Show loading modal
            showModal(
                'Generating PDF Report',
                '<div style="text-align: center;"><div class="loading"></div><p style="margin-top: 1rem;">Preparing comprehensive financial report...</p></div>',
                ''
            );
            
            // Simulate PDF generation time
            setTimeout(() => {
                closeModal();
                
                // Create and download a mock PDF file
                const pdfContent = generatePDFContent();
                const blob = new Blob([pdfContent], { type: 'application/pdf' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = 'Arcim_Financial_Report_' + new Date().toISOString().split('T')[0] + '.pdf';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                // Show success modal
                showModal(
                    'Download Complete',
                    '<p>Your comprehensive financial report has been downloaded successfully.</p><p style="margin-top: 1rem; color: #666; font-size: 0.875rem;">The PDF contains all risk metrics, financial analysis, and compliance information.</p>',
                    '<button class="btn btn-primary" onclick="closeModal()">Done</button>'
                );
            }, 2500);
        }

        function generatePDFContent() {
            const reports = demoData.reports;
            const currentDate = new Date().toLocaleDateString();
            
            // This is a simplified PDF content simulation
            // In a real implementation, you would use a PDF library like jsPDF
            return `%PDF-1.4
1 0 obj
<< /Type /Catalog /Pages 2 0 R >>
endobj
2 0 obj
<< /Type /Pages /Kids [3 0 R] /Count 1 >>
endobj
3 0 obj
<< /Type /Page /Parent 2 0 R /MediaBox [0 0 612 792] /Contents 4 0 R >>
endobj
4 0 obj
<< /Length 500 >>
stream
BT
/F1 12 Tf
50 750 Td
(ARCIM FINANCIAL REPORT) Tj
0 -20 Td
(Generated: ${currentDate}) Tj
0 -40 Td
(Risk Grade: ${reports.riskGrade}) Tj
0 -20 Td
(DSCR Base/Downside: ${reports.dscrBase} / ${reports.dscrDownside}) Tj
0 -20 Td
(Runway: ${reports.runway}) Tj
0 -20 Td
(Median Net CF/mo: ${reports.medianNetCF}) Tj
0 -20 Td
(Working Capital - DSO: ${reports.dso}, DPO: ${reports.dpo}, CCC: ${reports.ccc}) Tj
0 -20 Td
(AR Aging: ${reports.arTotal}, ${reports.arAging}) Tj
0 -20 Td
(AP Aging: ${reports.apTotal}) Tj
0 -20 Td
(Debt Service: ${reports.existingDebt}) Tj
0 -20 Td
(Proposed: ${reports.proposedLoan} -> ${reports.proposedPayment}) Tj
0 -20 Td
(Cash Flow: In ${reports.cashFlowSeries.cashIn}, Out ${reports.cashFlowSeries.cashOut}, Net ${reports.cashFlowSeries.net}) Tj
0 -20 Td
(Compliance: ${reports.compliance}) Tj
0 -20 Td
(Concentration: ${reports.concentration}) Tj
ET
endstream
endobj
xref
0 5
0000000000 65535 f 
0000000009 00000 n 
0000000058 00000 n 
0000000115 00000 n 
0000000204 00000 n 
trailer
<< /Size 5 /Root 1 0 R >>
startxref
756
%%EOF`;
        }

        // FSP Company Switching Functions
        function switchFSPCompany(companyKey) {
            if (companyKey) {
                selectedFSPCompany = companyKey;
                // Update dropdown selection
                const selector = document.getElementById('companySelector');
                if (selector) {
                    selector.value = companyKey;
                }
            }
        }

        function renderFSPCompanyView() {
            if (!selectedFSPCompany) {
                showModal('Error', 'Please select a company first.', '<button class="btn btn-primary" onclick="closeModal()">OK</button>');
                return;
            }
            
            // Hide navigation bar for FSP portal
            const navBar = document.querySelector('.nav-bar');
            if (navBar) navBar.style.display = 'none';
            
            const company = demoData.companies[selectedFSPCompany];
            const content = document.getElementById('content');
            
            content.innerHTML = `
                <div class="dashboard dashboard-dark">
                    <div class="sidebar">
                        <div class="sidebar-logo">
                            <img src="arcim-logo.svg" alt="Arcim" style="height: 75px; filter: brightness(0) invert(1);">
                        </div>
                        <ul class="sidebar-nav">
                            <li class="sidebar-nav-item" onclick="renderFSPDashboard()">
                                <img src="house-svgrepo-com.svg" alt="Portfolio" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Portfolio
                            </li>
                            <li class="sidebar-nav-item active">
                                <img src="reports-svgrepo-com.svg" alt="Company View" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Company View
                            </li>
                            <li class="sidebar-nav-item" onclick="renderFSPReports()">
                                <img src="reports-svgrepo-com.svg" alt="Reports" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Reports
                            </li>
                            <li class="sidebar-nav-item" onclick="renderFSPAIChat()">
                                <img src="ai-svgrepo-com.svg" alt="AI Chat" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                AI Chat
                            </li>
                            <li class="sidebar-nav-item">
                                <img src="settings-svgrepo-com.svg" alt="Settings" style="height: 20px; width: 20px; filter: brightness(0) invert(1);">
                                Settings
                            </li>
                        </ul>
                    </div>
                    
                    <div class="main-content">
                        <!-- Company Header -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <div>
                                <h1 style="color: #ffffff; font-family: 'Manrope', sans-serif; font-size: 1.75rem; margin: 0;">${company.name}</h1>
                                <p style="color: #cccccc; font-family: 'Manrope', sans-serif; font-size: 0.875rem; margin: 0.5rem 0 0 0;">${company.industry} • Risk Score: ${company.riskScore}/100 • ${company.riskLevel} Risk</p>
                            </div>
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <select id="companySelector" onchange="switchFSPCompany(this.value); renderFSPCompanyView();" style="background: #5a5a5a; color: #ffffff; border: 1px solid #6a6a6a; padding: 0.75rem 1rem; border-radius: 6px; font-family: 'Manrope', sans-serif;">
                                    ${Object.entries(demoData.companies).map(([key, comp]) => `
                                        <option value="${key}" ${key === selectedFSPCompany ? 'selected' : ''}>${comp.name}</option>
                                    `).join('')}
                                </select>
                                <button onclick="renderFSPDashboard()" style="background: transparent; color: #cccccc; border: 1px solid #6a6a6a; padding: 0.75rem 1rem; border-radius: 6px; font-family: 'Manrope', sans-serif; cursor: pointer;">
                                    ← Back to Portfolio
                                </button>
                            </div>
                        </div>
                        
                        <!-- Company Dashboard - Same as SME Dashboard -->
                        <div class="dashboard-grid">
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Pro-forma DSCR</div>
                                <div class="dashboard-card-value">${company.metrics.proFormaDSCR}</div>
                                <div class="dashboard-card-change">${company.metrics.proFormaDSCRChange}</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Cash Runway</div>
                                <div class="dashboard-card-value">${company.metrics.cashRunway}</div>
                                <div class="dashboard-card-change">${company.metrics.cashRunwayChange}</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Median Net Cash Flow / mo (+ volatility)</div>
                                <div class="dashboard-card-value">${company.metrics.medianNetCashFlow} (${company.metrics.medianNetCashFlowCV})</div>
                                <div class="dashboard-card-change">${company.metrics.medianNetCashFlowChange}</div>
                            </div>
                        </div>
                        
                        <div class="dashboard-large-section">
                            <div class="dashboard-chart">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h3 style="color: #cccccc; font-family: 'Manrope', sans-serif; font-weight: normal; font-size: 0.875rem; margin: 0;">12-month Cash In vs Cash Out vs Net</h3>
                                    <div style="display: flex; gap: 1rem;">
                                        <button id="lastYearBtn" onclick="switchYear('lastYear')" style="background: #5a5a5a; color: #ffffff; border: 1px solid #6a6a6a; padding: 0.5rem 1rem; border-radius: 6px; font-family: 'Manrope', sans-serif; cursor: pointer;">Last year</button>
                                        <button id="thisYearBtn" onclick="switchYear('thisYear')" style="background: transparent; color: #cccccc; border: 1px solid #6a6a6a; padding: 0.5rem 1rem; border-radius: 6px; font-family: 'Manrope', sans-serif; cursor: pointer;">This year</button>
                                    </div>
                                </div>
                                <div id="cashValue" style="font-size: 2rem; font-weight: normal; margin-bottom: 1rem; color: #ffffff; font-family: 'Manrope', sans-serif;">22.4M <span style="font-size: 1rem; color: #4ade80;">+8%</span></div>
                                <div class="chart-bars" style="height: 200px; position: relative; padding: 20px 0 0 0;">
                                    <div style="position: absolute; left: 0; top: 20px; bottom: 0; display: flex; flex-direction: column; justify-content: space-between; color: #666; font-size: 0.875rem; padding: 0 0 0 10px; width: 30px;">
                                        <div>25</div>
                                        <div>20</div>
                                        <div>15</div>
                                        <div>10</div>
                                    </div>
                                    <div id="chartContainer" style="display: flex; align-items: flex-end; justify-content: space-between; height: 100%; width: 100%; padding-left: 30px;">
                                        ${generateDashboardChartBars()}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-chart">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h3 style="color: #cccccc; font-family: 'Manrope', sans-serif; font-weight: normal; font-size: 0.875rem; margin: 0;">Largest Unpaid Invoices</h3>
                                </div>
                                ${company.unpaidInvoices.slice(0, 4).map(invoice => `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="background: ${invoice.color}; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; font-weight: 600;">
                                                ${invoice.logo}
                                            </div>
                                            <span style="color: #ffffff; font-size: 0.875rem;">${invoice.company}</span>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="color: #ffffff; font-size: 0.875rem;">${invoice.amount}</div>
                                            <div style="color: #cccccc; font-size: 0.75rem;">${invoice.days}</div>
                                        </div>
                                    </div>
                                `).join('')}
                                <div style="text-align: right; margin-top: 1rem;">
                                    <a href="#" style="color: #fbbf24; text-decoration: none;">See all</a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-grid">
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">DSO</div>
                                <div class="dashboard-card-value">${company.metrics.dso}</div>
                                <div class="dashboard-card-change">${company.metrics.dsoChange}</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">DPO</div>
                                <div class="dashboard-card-value">${company.metrics.dpo}</div>
                                <div class="dashboard-card-change">${company.metrics.dpoChange}</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-card-label">Cash Conversion Cycle (no inventory)</div>
                                <div class="dashboard-card-value">${company.metrics.cashConversionCycle}</div>
                                <div class="dashboard-card-change">${company.metrics.cashConversionChange}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // FSP Reports and AI Chat Functions (placeholder for now)
        function renderFSPReports() {
            // Similar to renderReports but for FSP selected company
            showModal('Feature Available', 'Reports feature for selected company coming soon!', '<button class="btn btn-primary" onclick="closeModal()">OK</button>');
        }

        function renderFSPAIChat() {
            // Similar to renderAIChat but for FSP selected company  
            showModal('Feature Available', 'AI Chat feature for selected company coming soon!', '<button class="btn btn-primary" onclick="closeModal()">OK</button>');
        }

        // Chat functionality
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            
            // Clear input
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate AI response after a delay
            setTimeout(() => {
                hideTypingIndicator();
                const aiResponse = generateAIResponse(message);
                addChatMessage(aiResponse, 'ai');
            }, 1500);
        }

        function addChatMessage(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div style="display: flex; align-items: flex-start; margin-bottom: 1rem; justify-content: flex-end;">
                        <div style="background: rgba(255, 255, 255, 0.2); padding: 0.75rem 1rem; border-radius: 12px 12px 4px 12px; max-width: 70%;">
                            <p style="color: #ffffff; margin: 0; font-family: 'Manrope', sans-serif; font-size: 0.875rem;">
                                ${message}
                            </p>
                        </div>
                        <div style="background: #ffffff; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; margin-left: 0.75rem; flex-shrink: 0;">
                            <span style="color: #000000; font-size: 14px; font-weight: 600;">U</span>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div style="display: flex; align-items: flex-start; margin-bottom: 1rem;">
                        <div style="background: #4A90E2; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; flex-shrink: 0;">
                            <img src="ai-svgrepo-com.svg" alt="AI" style="height: 16px; width: 16px; filter: brightness(0) invert(1);">
                        </div>
                        <div style="background: rgba(74, 144, 226, 0.2); padding: 0.75rem 1rem; border-radius: 12px 12px 12px 4px; max-width: 70%;">
                            <p style="color: #ffffff; margin: 0; font-family: 'Manrope', sans-serif; font-size: 0.875rem;">
                                ${message}
                            </p>
                        </div>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div style="display: flex; align-items: flex-start; margin-bottom: 1rem;">
                    <div style="background: #4A90E2; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; flex-shrink: 0;">
                        <img src="ai-svgrepo-com.svg" alt="AI" style="height: 16px; width: 16px; filter: brightness(0) invert(1);">
                    </div>
                    <div style="background: rgba(74, 144, 226, 0.2); padding: 0.75rem 1rem; border-radius: 12px 12px 12px 4px;">
                        <div style="display: flex; gap: 4px;">
                            <div style="width: 8px; height: 8px; background: #cccccc; border-radius: 50%; animation: typing 1.4s infinite; animation-delay: 0s;"></div>
                            <div style="width: 8px; height: 8px; background: #cccccc; border-radius: 50%; animation: typing 1.4s infinite; animation-delay: 0.2s;"></div>
                            <div style="width: 8px; height: 8px; background: #cccccc; border-radius: 50%; animation: typing 1.4s infinite; animation-delay: 0.4s;"></div>
                        </div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function generateAIResponse(userMessage) {
            const reports = demoData.reports;
            const lowerMessage = userMessage.toLowerCase();
            
            // Financial metrics responses
            if (lowerMessage.includes('risk') || lowerMessage.includes('grade')) {
                return `Your current risk grade is ${reports.riskGrade}, which indicates a relatively low risk profile. This is based on your strong DSCR of ${reports.dscrBase} and healthy cash flow patterns.`;
            }
            
            if (lowerMessage.includes('dscr')) {
                return `Your Debt Service Coverage Ratio (DSCR) is ${reports.dscrBase} under base case assumptions and ${reports.dscrDownside} in a downside scenario. This indicates good ability to service debt obligations.`;
            }
            
            if (lowerMessage.includes('cash flow') || lowerMessage.includes('runway')) {
                return `Your cash runway is ${reports.runway}, with a median net cash flow of ${reports.medianNetCF} per month. The volatility shows ${reports.medianNetCFDetails}, indicating some seasonal variation but overall positive trends.`;
            }
            
            if (lowerMessage.includes('working capital') || lowerMessage.includes('dso') || lowerMessage.includes('dpo')) {
                return `Your working capital metrics show: DSO of ${reports.dso}, DPO of ${reports.dpo}, resulting in a cash conversion cycle of ${reports.ccc}. The negative CCC means you're collecting receivables faster than paying suppliers, which is excellent for cash flow.`;
            }
            
            if (lowerMessage.includes('debt') || lowerMessage.includes('loan')) {
                return `Your existing debt service is ${reports.existingDebt}. The proposed loan terms are ${reports.proposedLoan}, which would result in monthly payments of ${reports.proposedPayment}. This represents a manageable increase in debt service given your current cash flow.`;
            }
            
            if (lowerMessage.includes('compliance') || lowerMessage.includes('tax')) {
                return `Your compliance status is strong: ${reports.compliance}. This indicates good operational management and low regulatory risk.`;
            }
            
            if (lowerMessage.includes('customer') || lowerMessage.includes('concentration')) {
                return `Your customer concentration shows ${reports.concentration}. While this indicates some concentration risk, it's within acceptable ranges for your industry sector.`;
            }
            
            if (lowerMessage.includes('summary') || lowerMessage.includes('overview')) {
                return `Here's a summary of your financial position: Risk Grade ${reports.riskGrade}, DSCR ${reports.dscrBase}, ${reports.runway} runway, with strong working capital management (CCC ${reports.ccc}). Your 12-month cash flow shows ${reports.cashFlowSeries.net} net positive flow. Overall, you have a solid financial foundation.`;
            }
            
            // Default responses for unrecognized queries
            const defaultResponses = [
                "I can help you understand your financial metrics better. Try asking about your risk grade, cash flow, DSCR, or working capital.",
                "Based on your data, you have strong financial fundamentals. What specific metric would you like me to explain?",
                "Your financial profile shows good performance across key metrics. Feel free to ask about any specific aspect of your financials.",
                "I have access to your complete financial analysis. What would you like to know more about?"
            ];
            
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }

        function simulateExport() {
            closeModal();
            showModal(
                'Exporting',
                '<div style="text-align: center;"><div class="loading"></div><p style="margin-top: 1rem;">Generating export...</p></div>',
                ''
            );
            
            setTimeout(() => {
                closeModal();
                showModal(
                    'Export Complete',
                    'Your data has been exported successfully. In a real application, the file would now download.',
                    '<button class="btn btn-primary" onclick="closeModal()">Done</button>'
                );
            }, 2000);
        }

        function showModal(title, body, footer) {
            const modal = document.getElementById('modal');
            document.getElementById('modalHeader').textContent = title;
            document.getElementById('modalBody').innerHTML = body;
            document.getElementById('modalFooter').innerHTML = footer;
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // Initialize app
        window.onload = function() {
            navigateTo('landing');
        };
        
        // Close modal on background click
        document.getElementById('modal').onclick = function(e) {
            if (e.target.id === 'modal') {
                closeModal();
            }
        };
    </script>
</body>
</html>